function run_choropleth(){console.log("test");var t=window.innerHeight,a=window.innerWidth,e=d3.select("div#choropleth").append("svg").attr("transform","translate(0,20)").attr("height",t-20-70).attr("width",a-50-50),n=d3.scaleQuantile().range(colorbrewer.Reds[4]),r=d3.tip().attr("id","tooltip").style("color","rgba(236, 236, 236)").style("background","rgba(71, 68, 68, 0.8)").style("font-weight","bold").style("padding","10px").html(function(t){return void 0===games[t.properties.name]?(rating="N/A",user="N/A"):(rating=games[t.properties.name][0],user=games[t.properties.name][1]),"<strong>Country: </strong><span>"+t.properties.name+"</span></br><strong>Game: </strong><span>"+selectedGame+"</span></br><strong>Avg Rating: </strong><span>"+rating+"</span></br><strong>Number of Users: </strong><span>"+user+"</span>"}),o=d3.geoNaturalEarth(),s=d3.geoPath().projection(o),d=d3.json("/assets/data/world_countries.json"),c=d3.csv("/assets/data/ratings-by-country.csv");function l(t,o,d){for(e.selectAll("*").remove(),games=o[d],g=[],i=0;i<t.features.length;i++)games[t.features[i].properties.name]&&g.push(games[t.features[i].properties.name][0]);n.domain(g.sort(function(t,a){return t-a})),e.append("g").attr("id","countries").selectAll("path").data(t.features).enter().append("path").attr("fill",function(t){return games[t.properties.name]?value=games[t.properties.name][0]:value=0,0===value?"grey":n(value)}).attr("stroke","black").attr("d",s).on("mouseover",r.show).on("mousemove",function(){r.style("top",d3.mouse(this)[1]+100+"px").style("left",d3.mouse(this)[0]+20+"px")}).on("mouseout",r.hide),e.append("g").attr("id","legend").attr("transform","translate("+(a/2+50+50)+",20)");var c=d3.legendColor().labelFormat(d3.format(".2f")).scale(n);e.select("#legend").call(c),e.call(r)}Promise.all([d,c]).then(function(t){!function(t,a,e){if(t)throw t;var n=[],r={};for(i=0;i<e.length;i++)n.includes(e[i].Game)||(n.push(e[i].Game),r[e[i].Game]={}),r[e[i].Game][e[i].Country]=[parseFloat(e[i]["Average Rating"]),parseInt(e[i]["Number of Users"])],n=n.sort();d3.select("#gameDropdown").selectAll("option").data(n).enter().append("option").attr("value",function(t){return t}).text(function(t){return t}),d3.select("#gameDropdown").on("change",function(){selectedGame=d3.select(this).property("value"),l(a,r,selectedGame)}),l(a,r,selectedGame=n[0])}(error=!1,t[0],t[1])})}function run_node(){d3.dsv(",","assets/data/board_games.csv",function(t){return{source:t.source,target:t.target,value:+t.value}}).then(function(t){var a=t,e={},n=d3.scaleLinear().domain([0]);a.forEach(function(t){t.source=e[t.source]||(e[t.source]={name:t.source}),t.target=e[t.target]||(e[t.target]={name:t.target})});var r=window.innerWidth,o=window.innerHeight,i=d3.scaleSequential().domain([1,10]).interpolator(d3.interpolatePuBuGn),s=d3.forceSimulation().nodes(d3.values(e)).force("link",d3.forceLink(a).distance(100)).force("center",d3.forceCenter(r/2,o/2)).force("x",d3.forceX()).force("y",d3.forceY()).force("charge",d3.forceManyBody().strength(-250)).alphaTarget(1).on("tick",function(){c.attr("d",function(t){var a=t.target.x-t.source.x,e=t.target.y-t.source.y,n=Math.sqrt(a*a+e*e);return"M"+t.source.x+","+t.source.y+"A"+n+","+n+" 0 0,1 "+t.target.x+","+t.target.y}),l.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}),d=d3.select("div#node").append("svg").attr("width",r).attr("height",o),c=d.append("g").selectAll("path").data(a).enter().append("path").attr("class",function(t){return"link "+t.type}).style("stroke",function(t){return t.value<1?"gray":"green"}).style("stroke-width",function(t){return t.value<1?5:1}).style("stroke-dasharray",function(t){if(t.value>=1)return"10,3"}),l=d.selectAll(".node").data(s.nodes()).enter().append("g").attr("class","node").call(d3.drag().on("start",function(t){d3.event.active||s.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y}).on("drag",function(t){t.fx=d3.event.x,t.fy=d3.event.y,t.fixed=!0}).on("end",function(t){d3.event.active||s.alphaTarget(0),1==t.fixed?(t.fx=t.x,t.fy=t.y,d3.select(this).select("circle").style("fill","red")):(t.fx=null,t.fy=null)}));n=d3.scaleLinear().domain([0,20]).range([5,15]),l.append("circle").attr("id",function(t){return t.name.replace(/\s+/g,"").toLowerCase()}).attr("r",function(t){return t.weight=c.filter(function(a){return a.source.index==t.index||a.target.index==t.index}).size(),n(10+2*t.weight)}).style("fill",function(t){return i(t.weight)}).on("dblclick",function(t){t.fixed=!1,t.fx=null,t.fy=null,d3.select(this).style("fill",function(t){return i(t.weight)})}),l.append("text").attr("dx","15px").style("font-weight","bold").text(function(t){return t.name})}).catch(function(t){console.log(t)})}function run_line(){var t=window.innerHeight,a=window.innerWidth,e=50,n=50,r=50,o=50;const i=d3.timeFormat("%b %y"),s=d3.timeParse("%Y-%m-%d");var d=d3.dsv(",","assets/data/boardgame_ratings.csv",function(t){return{date:s(t.date),catan_count:+t["Catan=count"],catan_rank:+t["Catan=rank"],dominion_count:+t["Dominion=count"],dominion_rank:+t["Dominion=rank"],codenames_count:+t["Codenames=count"],codenames_rank:+t["Codenames=rank"],mars_count:+t["Terraforming Mars=count"],mars_rank:+t["Terraforming Mars=rank"],gloomhaven_count:+t["Gloomhaven=count"],gloomhaven_rank:+t["Gloomhaven=rank"],magic_count:+t["Magic: The Gathering=count"],magic_rank:+t["Magic: The Gathering=rank"],dixit_count:+t["Dixit=count"],dixit_rank:+t["Dixit=rank"],monopoly_count:+t["Monopoly=count"],monopoly_rank:+t["Monopoly=rank"]}}),c=d3.selectAll("div#container").append("svg").attr("id","svg-a").attr("height",t).attr("width",a-o-r-30).attr("transform","translate(50,50)").append("g").attr("id","plot-a").attr("transform","translate(70,20)");c.append("text").attr("id","title-a").attr("y",-10).attr("transform","translate("+(a/2-o-r)+",20)").attr("text-anchor","middle").style("font-size","14px").text("Number of Ratings 2016-2020"),d.then(function(s){var d={0:{id:"Catan",values:s.map(function(t,a){return{date:t.date,count:t.catan_count,rank:t.catan_rank}})},1:{id:"Dominion",values:s.map(function(t,a){return{date:t.date,count:t.dominion_count,rank:t.dominion_rank}})},2:{id:"Codenames",values:s.map(function(t,a){return{date:t.date,count:t.codenames_count,rank:t.codenames_rank}})},3:{id:"Terraforming Mars",values:s.map(function(t,a){return{date:t.date,count:t.mars_count,rank:t.mars_rank}})},4:{id:"Gloomhaven",values:s.map(function(t,a){return{date:t.date,count:t.gloomhaven_count,rank:t.gloomhaven_rank}})},5:{id:"Magic: The Gathering",values:s.map(function(t,a){return{date:t.date,count:t.magic_count,rank:t.magic_rank}})},6:{id:"Dixit",values:s.map(function(t,a){return{date:t.date,count:t.dixit_count,rank:t.dixit_rank}})},7:{id:"Monopoly",values:s.map(function(t,a){return{date:t.date,count:t.monopoly_count,rank:t.monopoly_rank}})}},l=d3.scaleOrdinal(d3.schemeCategory10),u=d3.scaleTime().domain(d3.extent(s,function(t){return t.date})).range([0,a-200-200]),m=d3.scaleLinear().domain([0,d3.max(d3.values(d),t=>d3.max(t.values,t=>t.count))]).range([t-n-e,0]),f=d3.axisBottom().ticks(d3.timeMonth.every(3)).tickFormat(i).scale(u),p=d3.axisLeft().scale(m);c.append("g").attr("class","axis").attr("id","x-axis-a").attr("transform","translate(0,"+(t-e-n)+")").call(f).append("text").attr("x",a/3+o+r).attr("y",50).style("text-anchor","middle").text("Month"),c.append("g").attr("class","axis").attr("id","y-axis-a").call(p).append("text").attr("transform","rotate(-90)").attr("dy",".5em").attr("y",-60).attr("x",-(t/3+e)).style("text-anchor","end").text("Num of Ratings");const g=d3.line().x(function(t){return u(t.date)}).y(function(t){return m(t.count)});let x=0;const h=function(){return d3.schemeCategory10[x++]};var y=c.append("g");Object.keys(d).forEach(t=>y.attr("id","lines-a").append("path").datum(d[t].values).attr("fill","none").style("stroke",function(a,e){return l(t)}).attr("stroke-width",1.5).attr("d",g)),Object.keys(d).forEach(t=>y.append("text").datum(d[t]).attr("class","label").attr("x",a-r-340).attr("y",function(t){return m(t.values[t.values.length-1].count)}).attr("dy",".35em").attr("text-anchor","start").style("fill",h).text(function(t){return t.id}))});var l=d3.selectAll("div#container").append("svg").attr("id","svg-b").attr("height",t).attr("width",a-o-r-30).attr("transform","translate(50,50)").append("g").attr("id","plot-b").attr("transform","translate(70,20)");l.append("text").attr("id","title-b").attr("y",-10).attr("transform","translate("+(a/2-o-r)+",20)").attr("text-anchor","middle").style("font-size","14px").text("Number of Ratings 2016-2020 with Rankings"),d.then(function(s){var d={0:{id:"Catan",values:s.map(function(t,a){return{date:t.date,count:t.catan_count,rank:t.catan_rank}})},1:{id:"Dominion",values:s.map(function(t,a){return{date:t.date,count:t.dominion_count,rank:t.dominion_rank}})},2:{id:"Codenames",values:s.map(function(t,a){return{date:t.date,count:t.codenames_count,rank:t.codenames_rank}})},3:{id:"Terraforming Mars",values:s.map(function(t,a){return{date:t.date,count:t.mars_count,rank:t.mars_rank}})},4:{id:"Gloomhaven",values:s.map(function(t,a){return{date:t.date,count:t.gloomhaven_count,rank:t.gloomhaven_rank}})},5:{id:"Magic: The Gathering",values:s.map(function(t,a){return{date:t.date,count:t.magic_count,rank:t.magic_rank}})},6:{id:"Dixit",values:s.map(function(t,a){return{date:t.date,count:t.dixit_count,rank:t.dixit_rank}})},7:{id:"Monopoly",values:s.map(function(t,a){return{date:t.date,count:t.monopoly_count,rank:t.monopoly_rank}})}},c=d3.scaleOrdinal(d3.schemeCategory10),u=d3.scaleTime().domain(d3.extent(s,function(t){return t.date})).range([0,a-200-200]),m=d3.scaleLinear().domain([0,d3.max(d3.values(d),t=>d3.max(t.values,t=>t.count))]).range([t-n-e,0]),f=d3.axisBottom().ticks(d3.timeMonth.every(3)).tickFormat(i).scale(u),p=d3.axisLeft().scale(m);l.append("g").attr("class","axis").attr("id","x-axis-b").attr("transform","translate(0,"+(t-e-n)+")").call(f).append("text").attr("x",a/3+o+r).attr("y",50).style("text-anchor","middle").text("Month"),l.append("g").attr("class","axis").attr("id","y-axis-b").call(p).append("text").attr("transform","rotate(-90)").attr("dy",".5em").attr("y",-60).attr("x",-(t/3+e)).style("text-anchor","end").text("Num of Ratings");const g=d3.line().x(function(t){return u(t.date)}).y(function(t){return m(t.count)});let x=0;const h=function(){return d3.schemeCategory10[x++]};var y=l.append("g").attr("id","lines-b");Object.keys(d).forEach(t=>y.append("path").datum(d[t].values).attr("fill","none").style("stroke",function(a,e){return c(t)}).attr("stroke-width",1.5).attr("d",g));var v=l.append("g").attr("id","symbols-b"),k=["Catan","Codenames","Terraforming Mars","Gloomhaven"];Object.keys(d).forEach(t=>v.selectAll("#symbols-b").data(d[t].values.filter(function(a,e){if(k.includes(d[t].id)&&(j=e+1,j%3==0&&0!==j))return a})).enter().append("circle").attr("class","dot").attr("cx",function(t){return u(t.date)}).attr("cy",function(t){return m(t.count)}).style("fill",function(a,e){return c(t)}).attr("r",12)),Object.keys(d).forEach(t=>v.selectAll("#symbols-b").data(d[t].values.filter(function(a,e){if(k.includes(d[t].id)&&(j=e+1,j%3==0&&0!==j))return a})).enter().append("text").style("stroke","white").style("font-size",8).attr("x",function(t){return u(t.date)}).attr("y",function(t){return m(t.count)+2}).attr("text-anchor","middle").text(function(t){return t.rank})),Object.keys(d).forEach(t=>y.append("text").datum(d[t]).attr("class","label").attr("x",a-r-330).attr("y",function(t){return m(t.values[t.values.length-1].count)}).attr("dy",".35em").attr("text-anchor","start").style("fill",h).text(function(t){return t.id}));var _=l.append("g").attr("id","legend-b");_.append("circle").attr("transform","translate("+(a-250-r)+","+(t-e-n-30)+")").style("fill","black").attr("r",15).selectAll(".legend"),_.append("text").attr("class","legend").attr("transform","translate("+(a-250-r)+","+(t-e-n-30)+")").style("fill","white").style("font-size",10).attr("text-anchor","middle").text("rank"),_.append("text").attr("transform","translate("+(a-300-r)+","+(t-e-n)+")").style("font-size",10).text("BoardGameGeek Rank")});var u=d3.selectAll("div#container").append("svg").attr("id","svg-c-1").attr("height",t).attr("width",a-o-r-30).attr("transform","translate(50,50)").append("g").attr("id","plot-c-1").attr("transform","translate(70,20)");u.append("text").attr("id","title-c-1").attr("y",-10).attr("transform","translate("+(a/2-o-r)+",20)").attr("text-anchor","middle").style("font-size","14px").text("Number of Ratings 2016-2020 (Square root Scale)"),d.then(function(s){var d={0:{id:"Catan",values:s.map(function(t,a){return{date:t.date,count:t.catan_count,rank:t.catan_rank}})},1:{id:"Dominion",values:s.map(function(t,a){return{date:t.date,count:t.dominion_count,rank:t.dominion_rank}})},2:{id:"Codenames",values:s.map(function(t,a){return{date:t.date,count:t.codenames_count,rank:t.codenames_rank}})},3:{id:"Terraforming Mars",values:s.map(function(t,a){return{date:t.date,count:t.mars_count,rank:t.mars_rank}})},4:{id:"Gloomhaven",values:s.map(function(t,a){return{date:t.date,count:t.gloomhaven_count,rank:t.gloomhaven_rank}})},5:{id:"Magic: The Gathering",values:s.map(function(t,a){return{date:t.date,count:t.magic_count,rank:t.magic_rank}})},6:{id:"Dixit",values:s.map(function(t,a){return{date:t.date,count:t.dixit_count,rank:t.dixit_rank}})},7:{id:"Monopoly",values:s.map(function(t,a){return{date:t.date,count:t.monopoly_count,rank:t.monopoly_rank}})}},c=d3.scaleOrdinal(d3.schemeCategory10),l=d3.scaleTime().domain(d3.extent(s,function(t){return t.date})).range([0,a-200-200]),m=d3.scaleSqrt().domain([0,d3.max(d3.values(d),t=>d3.max(t.values,t=>t.count))]).range([t-n-e,0]),f=d3.axisBottom().ticks(d3.timeMonth.every(3)).tickFormat(i).scale(l),p=d3.axisLeft().scale(m);u.append("g").attr("class","axis").attr("id","x-axis-c-1").attr("transform","translate(0,"+(t-e-n)+")").call(f).append("text").attr("x",a/3+o+r).attr("y",50).style("text-anchor","middle").text("Month"),u.append("g").attr("class","axis").attr("id","y-axis-c-1").call(p).append("text").attr("transform","rotate(-90)").attr("dy",".5em").attr("y",-60).attr("x",-(t/3+e)).style("text-anchor","end").text("Num of Ratings");const g=d3.line().x(function(t){return l(t.date)}).y(function(t){return m(t.count)});let x=0;const h=function(){return d3.schemeCategory10[x++]};var y=u.append("g").attr("id","lines-c-1");Object.keys(d).forEach(t=>y.append("path").datum(d[t].values).attr("fill","none").style("stroke",function(a,e){return c(t)}).attr("stroke-width",1.5).attr("d",g));var v=u.append("g").attr("id","symbols-c-1"),k=["Catan","Codenames","Terraforming Mars","Gloomhaven"];Object.keys(d).forEach(t=>v.selectAll("#symbols-c-1").data(d[t].values.filter(function(a,e){if(k.includes(d[t].id)&&(j=e+1,j%3==0&&0!==j))return a})).enter().append("circle").attr("class","dot").attr("cx",function(t){return l(t.date)}).attr("cy",function(t){return m(t.count)}).style("fill",function(a,e){return c(t)}).attr("r",12)),Object.keys(d).forEach(t=>v.selectAll("#symbols-c-1").data(d[t].values.filter(function(a,e){if(k.includes(d[t].id)&&(j=e+1,j%3==0&&0!==j))return a})).enter().append("text").attr("class","dlabel").style("stroke","white").style("font-size",8).attr("x",function(t){return l(t.date)}).attr("y",function(t){return m(t.count)+2}).attr("text-anchor","middle").text(function(t){return t.rank})),Object.keys(d).forEach(t=>y.append("text").datum(d[t]).attr("class","label").attr("x",a-r-330).attr("y",function(t){return m(t.values[t.values.length-1].count)}).attr("dy",".35em").attr("text-anchor","start").style("fill",h).text(function(t){return t.id}));var _=u.append("g").attr("id","legend-c-1");_.append("circle").attr("transform","translate("+(a-250-r)+","+(t-e-n-30)+")").style("fill","black").attr("r",15).selectAll(".legend"),_.append("text").attr("class","legend").attr("transform","translate("+(a-250-r)+","+(t-e-n-30)+")").style("fill","white").style("font-size",10).attr("text-anchor","middle").text("rank"),_.append("text").attr("transform","translate("+(a-300-r)+","+(t-e-n)+")").style("font-size",10).text("BoardGameGeek Rank")});var m=d3.selectAll("div#container").append("svg").attr("id","svg-c-2").attr("height",t+50).attr("width",a-o-r-30).attr("transform","translate(50,50)");m.append("text").attr("id","title-c-2").attr("y",-10).attr("transform","translate("+(a/2-o-r)+",30)").attr("text-anchor","middle").style("font-size","14px").text("Number of Ratings 2016-2020 (Log Scale)");var f=m.append("g").attr("id","plot-c-2").attr("transform","translate(70,50)");d.then(function(s){var d={0:{id:"Catan",values:s.map(function(t,a){return{date:t.date,count:t.catan_count,rank:t.catan_rank}})},1:{id:"Dominion",values:s.map(function(t,a){return{date:t.date,count:t.dominion_count,rank:t.dominion_rank}})},2:{id:"Codenames",values:s.map(function(t,a){return{date:t.date,count:t.codenames_count,rank:t.codenames_rank}})},3:{id:"Terraforming Mars",values:s.map(function(t,a){return{date:t.date,count:t.mars_count,rank:t.mars_rank}})},4:{id:"Gloomhaven",values:s.map(function(t,a){return{date:t.date,count:t.gloomhaven_count,rank:t.gloomhaven_rank}})},5:{id:"Magic: The Gathering",values:s.map(function(t,a){return{date:t.date,count:t.magic_count,rank:t.magic_rank}})},6:{id:"Dixit",values:s.map(function(t,a){return{date:t.date,count:t.dixit_count,rank:t.dixit_rank}})},7:{id:"Monopoly",values:s.map(function(t,a){return{date:t.date,count:t.monopoly_count,rank:t.monopoly_rank}})}},c=d3.scaleOrdinal(d3.schemeCategory10),l=d3.scaleTime().domain(d3.extent(s,function(t){return t.date})).range([0,a-200-200]),u=d3.scaleLog().domain([1,d3.max(d3.values(d),t=>d3.max(t.values,t=>t.count))]).range([t-n-e,0]),m=d3.axisBottom().ticks(d3.timeMonth.every(3)).tickFormat(i).scale(l),p=d3.axisLeft().scale(u);f.append("g").attr("class","axis").attr("id","x-axis-c-2").attr("transform","translate(0,"+(t-e-n)+")").call(m).append("text").attr("x",a/3+o+r).attr("y",50).style("text-anchor","middle").text("Month"),f.append("g").attr("class","axis").attr("id","y-axis-c-2").call(p).append("text").attr("transform","rotate(-90)").attr("dy",".5em").attr("y",-60).attr("x",-(t/3+e)).style("text-anchor","end").text("Num of Ratings");const g=d3.line().x(function(t){return l(t.date)}).y(function(t){return u(t.count)});let x=0;const h=function(){return d3.schemeCategory10[x++]};var y=f.append("g").attr("id","lines-c-2");Object.keys(d).forEach(t=>y.append("path").datum(d[t].values).attr("fill","none").style("stroke",function(a,e){return c(t)}).attr("stroke-width",1.5).attr("d",g));var v=f.append("g").attr("id","symbols-c-2"),k=["Catan","Codenames","Terraforming Mars","Gloomhaven"];Object.keys(d).forEach(t=>v.selectAll("#symbols-c-2").data(d[t].values.filter(function(a,e){if(k.includes(d[t].id)&&(j=e+1,j%3==0&&0!==j))return a})).enter().append("circle").attr("class","dot").attr("cx",function(t){return l(t.date)}).attr("cy",function(t){return u(t.count)}).style("fill",function(a,e){return c(t)}).attr("r",12)),Object.keys(d).forEach(t=>v.selectAll("#symbols-c-2").data(d[t].values.filter(function(a,e){if(k.includes(d[t].id)&&(j=e+1,j%3==0&&0!==j))return a})).enter().append("text").style("stroke","white").style("font-size",8).attr("x",function(t){return l(t.date)}).attr("y",function(t){return u(t.count)+2}).attr("text-anchor","middle").text(function(t){return t.rank})),Object.keys(d).forEach(t=>y.append("text").datum(d[t]).attr("class","label").attr("x",a-r-330).attr("y",function(t){return u(t.values[t.values.length-1].count)}).attr("dy",".35em").attr("text-anchor","start").style("fill",h).text(function(t){return t.id}));var _=f.append("g").attr("id","legend-c-2");_.append("circle").attr("transform","translate("+(a-250-r)+","+(t-e-n-30)+")").style("fill","black").attr("r",15).selectAll(".legend"),_.append("text").attr("class","legend").attr("transform","translate("+(a-250-r)+","+(t-e-n-30)+")").style("fill","white").style("font-size",10).attr("text-anchor","middle").text("rank"),_.append("text").attr("transform","translate("+(a-300-r)+","+(t-e-n)+")").style("font-size",10).text("BoardGameGeek Rank")})}